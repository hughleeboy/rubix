#include "cube.h"
#include "util.h"
#include "transformation.h"
#include <inttypes.h>
#include <stdio.h>
#include "coordinate.h"
#include "evaluator.h"
#include "solver.h"

uint8_t identity_transformation[6][3][3][3] = {
	{
		{{0,0,0},{0,0,1},{0,0,2}}, 
		{{0,1,0},{0,1,1},{0,1,2}}, 
		{{0,2,0},{0,2,1},{0,2,2}}, 
	},
	{
		{{1,0,0},{1,0,1},{1,0,2}}, 
		{{1,1,0},{1,1,1},{1,1,2}}, 
		{{1,2,0},{1,2,1},{1,2,2}}, 
	},
	{
		{{2,0,0},{2,0,1},{2,0,2}}, 
		{{2,1,0},{2,1,1},{2,1,2}}, 
		{{2,2,0},{2,2,1},{2,2,2}}, 
	},
	{
		{{3,0,0},{3,0,1},{3,0,2}}, 
		{{3,1,0},{3,1,1},{3,1,2}}, 
		{{3,2,0},{3,2,1},{3,2,2}}, 
	},
	{
		{{4,0,0},{4,0,1},{4,0,2}}, 
		{{4,1,0},{4,1,1},{4,1,2}}, 
		{{4,2,0},{4,2,1},{4,2,2}}, 
	},
	{
		{{5,0,0},{5,0,1},{5,0,2}}, 
		{{5,1,0},{5,1,1},{5,1,2}}, 
		{{5,2,0},{5,2,1},{5,2,2}}, 
	},
};

uint8_t white_clockwise[6][3][3][3] = {
	{
		{{0,2,0},{0,1,0},{0,0,0}}, 
		{{0,2,1},{0,1,1},{0,0,1}}, 
		{{0,2,2},{0,1,2},{0,0,2}}, 
	},
	{
		{{4,2,0},{1,0,1},{1,0,2}}, 
		{{4,2,1},{1,1,1},{1,1,2}}, 
		{{4,2,2},{1,2,1},{1,2,2}}, 
	},
	{
		{{2,0,0},{2,0,1},{2,0,2}}, 
		{{2,1,0},{2,1,1},{2,1,2}}, 
		{{2,2,0},{2,2,1},{2,2,2}}, 
	},
	{
		{{3,0,0},{3,0,1},{5,0,2}}, 
		{{3,1,0},{3,1,1},{5,1,2}}, 
		{{3,2,0},{3,2,1},{5,2,2}}, 
	},
	{
		{{4,0,0},{4,0,1},{4,0,2}}, 
		{{4,1,0},{4,1,1},{4,1,2}}, 
		{{3,2,2},{3,1,2},{3,0,2}}, 
	},
	{
		{{5,0,0},{5,0,1},{1,2,0}}, 
		{{5,1,0},{5,1,1},{1,1,0}}, 
		{{5,2,0},{5,2,1},{1,0,0}}, 
	},
};

uint8_t blue_clockwise[6][3][3][3] = {
	{
		{{0,0,0},{0,0,1},{5,2,2}}, 
		{{0,1,0},{0,1,1},{5,2,1}}, 
		{{0,2,0},{0,2,1},{5,2,0}}, 
	},
	{
		{{1,2,0},{1,1,0},{1,0,0}}, 
		{{1,2,1},{1,1,1},{1,0,1}}, 
		{{1,2,2},{1,1,2},{1,0,2}}, 
	},
	{
		{{4,2,2},{2,0,1},{2,0,2}}, 
		{{4,1,2},{2,1,1},{2,1,2}}, 
		{{4,0,2},{2,2,1},{2,2,2}}, 
	},
	{
		{{3,0,0},{3,0,1},{3,0,2}}, 
		{{3,1,0},{3,1,1},{3,1,2}}, 
		{{3,2,0},{3,2,1},{3,2,2}}, 
	},
	{
		{{4,0,0},{4,0,1},{0,0,2}}, 
		{{4,1,0},{4,1,1},{0,1,2}}, 
		{{4,2,0},{4,2,1},{0,2,2}}, 
	},
	{
		{{5,0,0},{5,0,1},{5,0,2}}, 
		{{5,1,0},{5,1,1},{5,1,2}}, 
		{{2,0,0},{2,1,0},{2,2,0}}, 
	},
};

uint8_t yellow_clockwise[6][3][3][3] = {
	{
		{{0,0,0},{0,0,1},{0,0,2}}, 
		{{0,1,0},{0,1,1},{0,1,2}}, 
		{{0,2,0},{0,2,1},{0,2,2}}, 
	},
	{
		{{1,0,0},{1,0,1},{5,2,0}}, 
		{{1,1,0},{1,1,1},{5,1,0}}, 
		{{1,2,0},{1,2,1},{5,0,0}}, 
	},
	{
		{{2,2,0},{2,1,0},{2,0,0}}, 
		{{2,2,1},{2,1,1},{2,0,1}}, 
		{{2,2,2},{2,1,2},{2,0,2}}, 
	},
	{
		{{4,0,2},{3,0,1},{3,0,2}}, 
		{{4,0,1},{3,1,1},{3,1,2}}, 
		{{4,0,0},{3,2,1},{3,2,2}}, 
	},
	{
		{{1,0,2},{1,1,2},{1,2,2}}, 
		{{4,1,0},{4,1,1},{4,1,2}}, 
		{{4,2,0},{4,2,1},{4,2,2}}, 
	},
	{
		{{3,0,0},{5,0,1},{5,0,2}}, 
		{{3,1,0},{5,1,1},{5,1,2}}, 
		{{3,2,0},{5,2,1},{5,2,2}}, 
	},
};

uint8_t green_clockwise[6][3][3][3] = {
	{
		{{4,0,0},{0,0,1},{0,0,2}}, 
		{{4,1,0},{0,1,1},{0,1,2}}, 
		{{4,2,0},{0,2,1},{0,2,2}}, 
	},
	{
		{{1,0,0},{1,0,1},{1,0,2}}, 
		{{1,1,0},{1,1,1},{1,1,2}}, 
		{{1,2,0},{1,2,1},{1,2,2}}, 
	},
	{
		{{2,0,0},{2,0,1},{5,0,0}}, 
		{{2,1,0},{2,1,1},{5,0,1}}, 
		{{2,2,0},{2,2,1},{5,0,2}}, 
	},
	{
		{{3,2,0},{3,1,0},{3,0,0}}, 
		{{3,2,1},{3,1,1},{3,0,1}}, 
		{{3,2,2},{3,1,2},{3,0,2}}, 
	},
	{
		{{2,2,2},{4,0,1},{4,0,2}}, 
		{{2,1,2},{4,1,1},{4,1,2}}, 
		{{2,0,2},{4,2,1},{4,2,2}}, 
	},
	{
		{{0,2,0},{0,1,0},{0,0,0}}, 
		{{5,1,0},{5,1,1},{5,1,2}}, 
		{{5,2,0},{5,2,1},{5,2,2}}, 
	},
};

uint8_t orange_clockwise[6][3][3][3] = {
	{
		{{1,0,0},{1,0,1},{1,0,2}}, 
		{{0,1,0},{0,1,1},{0,1,2}}, 
		{{0,2,0},{0,2,1},{0,2,2}}, 
	},
	{
		{{2,0,0},{2,0,1},{2,0,2}}, 
		{{1,1,0},{1,1,1},{1,1,2}}, 
		{{1,2,0},{1,2,1},{1,2,2}}, 
	},
	{
		{{3,0,0},{3,0,1},{3,0,2}}, 
		{{2,1,0},{2,1,1},{2,1,2}}, 
		{{2,2,0},{2,2,1},{2,2,2}}, 
	},
	{
		{{0,0,0},{0,0,1},{0,0,2}}, 
		{{3,1,0},{3,1,1},{3,1,2}}, 
		{{3,2,0},{3,2,1},{3,2,2}}, 
	},
	{
		{{4,2,0},{4,1,0},{4,0,0}}, 
		{{4,2,1},{4,1,1},{4,0,1}}, 
		{{4,2,2},{4,1,2},{4,0,2}}, 
	},
	{
		{{5,0,0},{5,0,1},{5,0,2}}, 
		{{5,1,0},{5,1,1},{5,1,2}}, 
		{{5,2,0},{5,2,1},{5,2,2}}, 
	},
};

uint8_t red_clockwise[6][3][3][3] = {
	{
		{{0,0,0},{0,0,1},{0,0,2}}, 
		{{0,1,0},{0,1,1},{0,1,2}}, 
		{{3,2,0},{3,2,1},{3,2,2}}, 
	},
	{
		{{1,0,0},{1,0,1},{1,0,2}}, 
		{{1,1,0},{1,1,1},{1,1,2}}, 
		{{0,2,0},{0,2,1},{0,2,2}}, 
	},
	{
		{{2,0,0},{2,0,1},{2,0,2}}, 
		{{2,1,0},{2,1,1},{2,1,2}}, 
		{{1,2,0},{1,2,1},{1,2,2}}, 
	},
	{
		{{3,0,0},{3,0,1},{3,0,2}}, 
		{{3,1,0},{3,1,1},{3,1,2}}, 
		{{2,2,0},{2,2,1},{2,2,2}}, 
	},
	{
		{{4,0,0},{4,0,1},{4,0,2}}, 
		{{4,1,0},{4,1,1},{4,1,2}}, 
		{{4,2,0},{4,2,1},{4,2,2}}, 
	},
	{
		{{5,2,0},{5,1,0},{5,0,0}}, 
		{{5,2,1},{5,1,1},{5,0,1}}, 
		{{5,2,2},{5,1,2},{5,0,2}}, 
	},
};


int main(){
	//uint8_t bits = 0b11111111;
	//printf("%" PRIu8 "\n", bits);
	//bits = setIntAtBits(bits, 0, 0, 8);
	//printf("%" PRIu8 "\n", bits);
	//bits = setIntAtBits(bits, 3, 1, 2);
	//printf("%" PRIu8 "\n", bits);

	// transformation t;
	// initTransformationFromArray(&t[0], identity_transformation);
	// printTransformation(&t);

	// transformation white_clock;
	// initTransformationFromArray(&white_clock, white_clockwise);
	// printTransformation(&white_clock);

	// transformation ts[5];
	// initTransformationFromArray(&ts[0], white_clockwise);
	// initTransformationFromArray(&ts[1], white_clockwise);
	// initTransformationFromArray(&ts[2], identity_transformation);
	// initTransformationFromArray(&ts[3], white_clockwise);
	// initTransformationFromArray(&ts[4], white_clockwise);

	// transformation composition;
	// initTransformationFromTransformations(&composition, ts, 5);
	// printTransformation(&composition);

	// cube c;
	// initCube(&c);
	// printCube(&c);
	// printf("Evaluation: %d\n", basicEvaluate(&c));
	
	// transformation white_clock;
	// initTransformationFromArray(&white_clock, white_clockwise);
	// transformCube(&c, &white_clock);
	// printCube(&c);
	// printf("Evaluation: %d\n", basicEvaluate(&c));

	char cubeState[54] = "wyyywwwww""byorbwbyo""bbybyrboy""ggggggggg""oryoorobr""rwrbrowor";
	cube c;
	cubeFromString(&c, cubeState);
	// printCube(&c);

	transformation ts[12];
	initTransformationFromArray(&ts[0], white_clockwise);
	initTransformationFromArray(&ts[1], blue_clockwise);
	initTransformationFromArray(&ts[2], yellow_clockwise);
	initTransformationFromArray(&ts[3], green_clockwise);
	initTransformationFromArray(&ts[4], orange_clockwise);
	initTransformationFromArray(&ts[5], red_clockwise);

	transformation temp_trans[3];
	for(int i=0; i<6; i++){
		temp_trans[0]=ts[i];
		temp_trans[1]=ts[i];
		temp_trans[2]=ts[i];
		initTransformationFromTransformations(&ts[i+6], temp_trans, 3);
	}

	solver s;

	//initCube(&c);
	evaluator e = teeEvaluate_e;
	initSolver(&s, &c, e, ts, 12, 7);
	solve(&s);

	return 0;
}
	
